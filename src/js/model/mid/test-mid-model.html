<html>
<head>
    <meta charset="utf-8">
    <script src="../../../../bower_components/web-component-tester/browser.js"></script>
    <link rel="import" href="../../../../bower_components/webcomponentsjs/webcomponents-lite.js">

    <script src="../../AMPSetup/AMPSetup.js"></script>
    <script src="../sdnv/sdnv.js"></script>
    <script src="ampStructureTypes.js"></script>
    <script src="midFlag.js"></script>
    <script src="mid.js"></script>
</head>
<body>
<script>

    suite("Managed Identifiers model tests", function()
    {

        var byteHex;
        var returnedObj;

        test("MID with issuer and tag", function()
        {
            //FF flag says we have an issuer and tag which are both 07
            //TODO:  Add OID and DC hex inbetween the issuer and tag
            byteHex = new AMPHexConsumer("FF0707");
            returnedObj = AMPParse.buildMid(byteHex);
            expect(returnedObj.returnValue.type).to.be.a("string").and.equal("Managed Identifier");
            expect(returnedObj.returnValue.header).to.exist;
            expect(returnedObj.returnValue.issuer.returnValue.type).to.be.a("string").and.equal("Sdnv");
            expect(returnedObj.returnValue.value.returnValue.type).to.be.a("string").and.equal("Object Identifier");
            expect(returnedObj.returnValue.parameters.returnValue.type).to.be.a("string").and.equal("Data Collection");
            expect(returnedObj.returnValue.tag.returnValue.type).to.be.a("string").and.equal("Sdnv");
        });

        test("MID without issuer and tag", function()
        {
            //00 flag says we do not have an issuer or tag
            //TODO:  Add OID and DC hex
            byteHex = new AMPHexConsumer("00");
            returnedObj = AMPParse.buildMid(byteHex);
            expect(returnedObj.returnValue.type).to.be.a("string").and.equal("Managed Identifier");
            expect(returnedObj.returnValue.header).to.exist;
            expect(returnedObj.returnValue.issuer).to.not.exist;
            expect(returnedObj.returnValue.value.returnValue.type).to.be.a("string").and.equal("Object Identifier");
            expect(returnedObj.returnValue.parameters.returnValue.type).to.be.a("string").and.equal("Data Collection");
            expect(returnedObj.returnValue.tag).to.not.exist;

        });

        test("throws ReferenceError on bad parameters", function()
        {
            expect(function() { AMPParse.buildMid(26); }).to.throw(ReferenceError);
            expect(function() { AMPParse.getStructTypeFromId("ABCD"); }).to.throw(ReferenceError);
        });
    });
</script>
</body>
</html>
